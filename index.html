<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <title>ÈÖç‰ª∂Êâ´Á†ÅÂΩïÂÖ•</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link crossorigin="anonymous" href="https://lib.baomitu.com/twitter-bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet" />
    <link crossorigin="anonymous" href="https://lib.baomitu.com/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link crossorigin="anonymous" href="https://lib.baomitu.com/highlight.js/11.10.0/styles/github-dark.css" rel="stylesheet" />
    <script crossorigin="anonymous" src="https://lib.baomitu.com/twitter-bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <script crossorigin="anonymous" src="https://lib.baomitu.com/highlight.js/11.10.0/highlight.min.js"></script>
</head>

<body class="container mb-5">
    <h5 class="text-center pt-2"><i class="bi bi-qr-code-scan px-2"></i>ÈÖç‰ª∂Êâ´Á†ÅÂΩïÂÖ•</h5>
    <div id="toastContainer" class="position-fixed top-0 start-50 translate-middle-x" style="z-index: 9999;"></div>
    <div class="row my-3">
        <div class="col">
            <label class="form-label fw-bold" for="orderNo">ÂçïÂè∑Ôºö</label>
            <input id="orderNo" type="text" class="form-control" placeholder="ËØ∑ËæìÂÖ•ÂçïÂè∑">
        </div>
        <div class="col text-end">
            <label class="form-label fw-bold" for="type">ÈÖç‰ª∂Á±ªÂûãÔºö</label>
            <select id="type" class="form-select">
                <option value="CPU">CPU</option>
                <option value="ÂÜÖÂ≠ò">ÂÜÖÂ≠ò</option>
                <option value="Á°¨Áõò">Á°¨Áõò</option>
                <option value="ÂÖâÊ®°Âùó">ÂÖâÊ®°Âùó</option>
                <option value="AOCÁ∫øÁºÜ">AOCÁ∫øÁºÜ</option>
                <option value="‰∏ªÊùø">‰∏ªÊùø</option>
                <option value="ÁîµÊ∫ê">ÁîµÊ∫ê</option>
                <option value="ÁΩëÂç°">ÁΩëÂç°</option>
                <option value="‰∫§Êç¢Êú∫">‰∫§Êç¢Êú∫</option>
            </select>
        </div>
    </div>
    <div id="switchInfoRow" class="row my-3 d-none">
        <div class="col-8 pe-1">
            <label class="form-label" for="switchLocation">‰∫§Êç¢Êú∫‰ΩçÁΩÆÔºö</label>
            <input id="switchLocation" type="text" class="form-control" placeholder="">
        </div>
        <div class="col-4 ps-1 text-end">
            <label class="form-label" for="portNo">Á´ØÂè£Ôºö</label>
            <input id="portNo" type="text" class="form-control" placeholder="">
        </div>
    </div>
    <div id="serverSNRow" class="my-3">
        <label class="form-label font-monospace" for="serverSN"><i class="bi bi-server px-1"></i>ÊúçÂä°Âô®SNÔºö</label>
        <input id="serverSN" type="text" class="form-control" placeholder="ËØ∑Êâ´Á†Å">
    </div>
    <div id="brandSection" class="row my-3 d-none">
        <div class="col">
            <label class="form-label text-danger fw-bold" for="newBrand">Êñ∞‰ª∂ÂìÅÁâåÔºö</label>
            <select id="newBrand" class="form-select"></select>
        </div>
        <div class="col text-end">
            <label class="form-label text-secondary fw-bold" for="oldBrand">Êóß‰ª∂ÂìÅÁâåÔºö</label>
            <select id="oldBrand" class="form-select"></select>
        </div>
    </div>
    <div class="form-group my-3">
        <label class="form-label d-flex justify-content-between" for="newSN">
            <span class="text-danger fw-bold">Êñ∞‰ª∂SNÔºö</span><small id="countNewSN" class="text-muted">Â≠óÁ¨¶Êï∞Ôºö0</small>
        </label>
        <input id="newSN" type="text" class="form-control" placeholder="">
    </div>
    <div class="form-group my-3">
        <label class="form-label d-flex justify-content-between" for="newPN">
            <span class="text-danger fw-bold">Êñ∞‰ª∂PNÔºö</span><span id="checkNewPN" class="text-success"></span><small id="countNewPN" class="text-muted">Â≠óÁ¨¶Êï∞Ôºö0</small>
        </label>
        <input id="newPN" list="newPnOptions" type="text" class="form-control" placeholder="" autocorrect="off">
        <datalist id="newPnOptions"></datalist>
    </div>
    <div class="form-group my-3">
        <label class="form-label d-flex justify-content-between" for="oldSN">
            <span class="text-secondary fw-bold">Êóß‰ª∂SNÔºö</span><small id="countOldSN" class="text-muted">Â≠óÁ¨¶Êï∞Ôºö0</small>
        </label>
        <input id="oldSN" type="text" class="form-control" placeholder="">
    </div>
    <div class="form-group my-3">
        <label class="form-label d-flex justify-content-between" for="oldPN">
            <span class="text-secondary fw-bold">Êóß‰ª∂PNÔºö</span><span id="checkOldPN" class="text-success"></span><small id="countOldPN" class="text-muted">Â≠óÁ¨¶Êï∞Ôºö0</small>
        </label>
        <input id="oldPN" list="oldPnOptions" type="text" class="form-control" placeholder="" autocorrect="off">
        <datalist id="oldPnOptions"></datalist>
    </div>
    <div class="d-flex justify-content-between align-items-center mb-1">
        <small class="form-label mb-0">È¢ÑËßàÂÜÖÂÆπÔºö</small>
        <button id="copyBtn" class="btn btn-primary"><i class="bi bi-copy pe-1"></i>Â§çÂà∂</button>
        <button class="btn btn-success" onclick="sendToFeishu()"><i class="bi bi-send pe-1"></i>ÂèëÈÄÅÂà∞È£û‰π¶</button>
    </div>
    <pre class="rounded"><code id="preview" class="language-plaintext"></code></pre>
    <script>
    const brandMap = {
        'AOCÁ∫øÁºÜ': ['HG GENUINE', 'INNOLIGHT', 'Hisense', 'WTD'],
        'ÂÖâÊ®°Âùó': ['HG GENUINE', 'INNOLIGHT', 'Hisense', 'Huawei', 'Finisar', 'WTD'],
        'ÂÜÖÂ≠ò': ['Samsung', 'Hynix', 'Micron'],
        'Á°¨Áõò': ['Seagate', 'Western Digital', 'Intel', 'Samsung', 'Micron', 'KIOXIA', 'Solidigm'],
        'CPU': ['Intel']
    };

    const pnDataMap = {
        'ÂÖâÊ®°Âùó': {
            'HG GENUINE': ['MTRS-01X11-G', 'MQD-12F1C', 'MQD-56F2C', 'MTRQ-4S101'],
            'INNOLIGHT': ['T-OL8CNT-N00', 'T-DQ8FNS-N01', 'T-DQ8FNS-N00', 'TR-FC13T-N00', 'TR-ZC13T-N00', 'T-DQ4CNT-N00', 'TR-FC13R-N00'],
            'WTD': ['RTXM500-410', 'RTXM420-431', 'RTXM500-560', 'RTXM600-230', 'OEO-M100-73-13-Q28', 'OEO-M100-62-13-Q28', 'RTXM228-551', 'RTXM228-401', 'RTXM290-806', 'RTXM420-550'],
            'Finisar': ['FTCD8613E1PCM', 'FTLX8574D3BCL', 'FTCD8613E2PCM-BY', 'FTCE4717E1PCB-BY', 'FTLX1475D3BCL'],
            'Huawei': ['OM3680SX200', 'OM3660FX102'],
            'Hisense': ['LMQ8811-PC+', 'LMS3821L-PCS', 'LTF8502-BC+', 'LMS3826-PC+', 'LTA1328-PC+'],
            'Crealights': ['B5CLOS800SR8'],
            'H3C': ['SFP-XG-LX-SM1310']
        },
        'AOCÁ∫øÁºÜ': {
            'HG GENUINE': ['ATRP-B005', 'ATRP-B007', 'ATRP-B010', 'ATRP-B020'],
            'INNOLIGHT': ['C-PD2FNM005-N00', 'C-PD2FNM007-N00', 'C-PD2FNM010-N00'],
            'Hisense': ['DMM8211-DC05', 'DMM8211-DC07', 'DMM8211-DC10', 'DMM8211-DC20'],
            'WTD': ['RTXM520-105', 'RTXM520-107', 'RTXM520-110', 'RTXM520-120', 'RTXM500-905', 'RTXM500-910']
        }
    };

    const orderNo = document.getElementById('orderNo');
    const typeSelect = document.getElementById('type');
    const switchLocation = document.getElementById('switchLocation');
    const portNo = document.getElementById('portNo');
    const serverSN = document.getElementById('serverSN');
    const serverSNRow = document.getElementById('serverSNRow');
    const switchInfoRow = document.getElementById('switchInfoRow');

    const newBrand = document.getElementById('newBrand');
    const oldBrand = document.getElementById('oldBrand');
    const newPN = document.getElementById('newPN');
    const oldPN = document.getElementById('oldPN');
    const newSN = document.getElementById('newSN');
    const oldSN = document.getElementById('oldSN');

    const newPnOptions = document.getElementById('newPnOptions');
    const oldPnOptions = document.getElementById('oldPnOptions');

    const countNewPN = document.getElementById('countNewPN');
    const countNewSN = document.getElementById('countNewSN');
    const countOldPN = document.getElementById('countOldPN');
    const countOldSN = document.getElementById('countOldSN');
    const checkNewPN = document.getElementById('checkNewPN');
    const checkOldPN = document.getElementById('checkOldPN');
    const preview = document.getElementById('preview');
    const copyBtn = document.getElementById('copyBtn');

    function showToast(msg, type = 'primary') {
        const container = document.getElementById('toastContainer');
        const toast = document.createElement('div');
        toast.className = `toast align-items-center text-bg-${type} border-0 show my-2`;
        toast.role = 'alert';
        toast.innerHTML = `
    <div class="d-flex">
      <div class="toast-body">${msg}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>`;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 1200);
    }

    function updateBrandOptions(type) {
        const brands = brandMap[type];
        const section = document.getElementById('brandSection');
        if (brands) {
            newBrand.innerHTML = brands.map(b => `<option value="${b}">${b}</option>`).join('');
            oldBrand.innerHTML = brands.map(b => `<option value="${b}">${b}</option>`).join('');
            section.classList.remove('d-none');
        } else {
            newBrand.innerHTML = '';
            oldBrand.innerHTML = '';
            section.classList.add('d-none');
        }
        updatePnOptions(type, newBrand.value, newPnOptions);
        updatePnOptions(type, oldBrand.value, oldPnOptions);
    }

    function updatePnOptions(type, brand, datalist) {
        const list = (pnDataMap[type] && pnDataMap[type][brand]) || [];
        datalist.innerHTML = list.map(pn => `<option value="${pn}">`).join('');
    }

    function formatSamsungMemoryPn(pn) {
        const index = pn.indexOf('M');
        return index !== -1 ? pn.slice(index) : pn;
    }



    function update() {
        const type = typeSelect.value;
        const order = orderNo.value.trim().match(/\d+/) ? . [0] || '';
        const isOptical = type === 'ÂÖâÊ®°Âùó';
        const switchLoc = switchLocation.value.trim();
        const port = portNo.value.trim();
        const server = serverSN.value.trim();
        const brand1 = newBrand.value || '';
        const brand2 = oldBrand.value || '';

        // üîß ÂÖ≥ÈîÆÔºöÁî® let Â£∞ÊòéÂèØ‰øÆÊîπÁöÑÂèòÈáè
        let pn1 = newPN.value.trim();
        let sn1 = newSN.value.trim();
        let pn2 = oldPN.value.trim();
        let sn2 = oldSN.value.trim();

        // Ê∏ÖÈô§ÊèêÁ§∫
        checkNewPN.textContent = '';
        checkOldPN.textContent = '';
        checkNewPN.className = '';
        checkOldPN.className = '';

        // Samsung ÂÜÖÂ≠òÊ†ºÂºèÂåñÈÄªËæë
        if (type === 'ÂÜÖÂ≠ò') {
            if (brand1 === 'Samsung' && pn1.length > 0) {
                const formatted = formatSamsungMemoryPn(pn1);
                pn1 = formatted;
                newPN.value = formatted;
            }

            if (brand2 === 'Samsung' && pn2.length > 0) {
                const formatted = formatSamsungMemoryPn(pn2);
                pn2 = formatted;
                oldPN.value = formatted;
            }
        }

        // ‚úÖ Â≠óÁ¨¶Êï∞ÁªüËÆ°ÔºàÂøÖÈ°ªÂú®Ê†ºÂºèÂåñ‰πãÂêéÔºâ
        countNewPN.textContent = `Â≠óÁ¨¶Êï∞Ôºö${pn1.length}`;
        countNewSN.textContent = `Â≠óÁ¨¶Êï∞Ôºö${sn1.length}`;
        countOldPN.textContent = `Â≠óÁ¨¶Êï∞Ôºö${pn2.length}`;
        countOldSN.textContent = `Â≠óÁ¨¶Êï∞Ôºö${sn2.length}`;

        // Samsung Ê†ºÂºèÊ†°È™åÊèêÁ§∫
        if (type === 'ÂÜÖÂ≠ò') {
            if (brand1 === 'Samsung' && pn1 && !pn1.startsWith('M')) {
                checkNewPN.textContent = 'ËØ∑Ê£ÄÊü•ÂÜÖÂ≠òPN';
                checkNewPN.className = 'text-danger me-2';
            }

            if (brand2 === 'Samsung' && pn2 && !pn2.startsWith('M')) {
                checkOldPN.textContent = 'ËØ∑Ê£ÄÊü•ÂÜÖÂ≠òPN';
                checkOldPN.className = 'text-danger me-2';
            }
        }

        // PN ‰∏ÄËá¥ÊÄßÊ£ÄÊü•ÔºàÂÜÖÂ≠òÊàñÁ°¨ÁõòÔºâ
        if ((type === 'ÂÜÖÂ≠ò' || type === 'Á°¨Áõò') && brand1 && brand2 && brand1 === brand2) {
            if (pn1 && pn2) {
                if (pn1 === pn2) {
                    checkNewPN.textContent = 'PN‰∏ÄËá¥';
                    checkOldPN.textContent = 'PN‰∏ÄËá¥';
                    checkNewPN.className = 'text-success me-2';
                    checkOldPN.className = 'text-success me-2';
                } else {
                    checkNewPN.textContent = 'PN‰∏ç‰∏ÄËá¥';
                    checkOldPN.textContent = 'PN‰∏ç‰∏ÄËá¥';
                    checkNewPN.className = 'text-danger me-2';
                    checkOldPN.className = 'text-danger me-2';
                }
            }
        }

        // ÊñáÊú¨È¢ÑËßàÁîüÊàê
        const positionText = isOptical ? `${switchLoc} ${port}` : `ÊúçÂä°Âô®SNÔºö${server}`;

        const text = `‰∏äÊñ∞‰∏ãÊóßÔºöÊõ¥Êç¢„Äå${type}„Äç
ÂçïÂè∑Ôºö${order}
${isOptical ? '‰ΩçÁΩÆÔºö' + positionText : positionText}
Êñ∞‰ª∂ÂìÅÁâåÔºö${brand1}
Êñ∞‰ª∂SNÔºö${sn1}
Êñ∞‰ª∂PNÔºö${pn1}
Êóß‰ª∂ÂìÅÁâåÔºö${brand2}
Êóß‰ª∂SNÔºö${sn2}
Êóß‰ª∂PNÔºö${pn2}`;

        preview.textContent = text;
        hljs.highlightElement(preview);
    }


    // Ê≥®ÂÜå‰∫ã‰ª∂
    typeSelect.addEventListener('change', () => {
        const type = typeSelect.value;
        const isOptical = type === 'ÂÖâÊ®°Âùó';
        serverSNRow.classList.toggle('d-none', isOptical);
        switchInfoRow.classList.toggle('d-none', !isOptical);
        updateBrandOptions(type);
        update();
    });

    [newBrand, oldBrand].forEach((select, index) => {
        select.addEventListener('change', () => {
            const type = typeSelect.value;
            const datalist = index === 0 ? newPnOptions : oldPnOptions;
            updatePnOptions(type, select.value, datalist);
            update();
        });
    });

    [
        orderNo, serverSN, switchLocation, portNo,
        newPN, newSN, oldPN, oldSN
    ].forEach(el => el.addEventListener('input', update));

    copyBtn.addEventListener('click', () => {
        const text = preview.innerText.trim();
        if (!text || text.includes('ËØ∑ÂºÄÂßãËæìÂÖ•')) {
            showToast('ËØ∑ÂÖàËæìÂÖ•ÂÆåÊï¥ÂÜÖÂÆπ', 'warning');
            return;
        }
        navigator.clipboard.writeText(text).then(() => {
            showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
        }).catch(() => {
            showToast('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂', 'danger');
        });
    });

    function sendToFeishu() {
        // Ëé∑ÂèñÂêÑÂ≠óÊÆµ
        const type = typeSelect.value;
        const order = orderNo.value.trim().match(/\d+/) ? . [0] || '';
        const isOptical = type === 'ÂÖâÊ®°Âùó';
        const switchLoc = switchLocation.value.trim();
        const port = portNo.value.trim();
        const server = serverSN.value.trim();
        const brand1 = newBrand.value || '';
        const brand2 = oldBrand.value || '';
        let pn1 = newPN.value.trim();
        let sn1 = newSN.value.trim();
        let pn2 = oldPN.value.trim();
        let sn2 = oldSN.value.trim();

        // ÁªÑË£ÖÂØåÊñáÊú¨ÂÜÖÂÆπ
        const contentArr = [
            [ // Á¨¨‰∏ÄË°å
                { tag: 'text', text: `‰∏äÊñ∞‰∏ãÊóßÔºöÊõ¥Êç¢„Äå${type}„Äç` }
            ],
            [ // ÂçïÂè∑Ë°åÔºåÂçïÂè∑‰∏∫Ë∂ÖÈìæÊé•
                { tag: 'text', text: 'ÂçïÂè∑Ôºö' },
                { tag: 'a', text: order, href: `https://pda.jsjs.net/preview?id=${order}` }
            ],
            [ // ÊúçÂä°Âô®SNÊàñ‰ΩçÁΩÆ
                { tag: 'text', text: isOptical ? `‰ΩçÁΩÆÔºö${switchLoc} ${port}` : `ÊúçÂä°Âô®SNÔºö${server}` }
            ],
            [{ tag: 'text', text: `Êñ∞‰ª∂ÂìÅÁâåÔºö${brand1}` }],
            [{ tag: 'text', text: `Êñ∞‰ª∂SNÔºö${sn1}` }],
            [{ tag: 'text', text: `Êñ∞‰ª∂PNÔºö${pn1}` }],
            [{ tag: 'text', text: `Êóß‰ª∂ÂìÅÁâåÔºö${brand2}` }],
            [{ tag: 'text', text: `Êóß‰ª∂SNÔºö${sn2}` }],
            [{ tag: 'text', text: `Êóß‰ª∂PNÔºö${pn2}` }]
        ];

        const feishuPost = {
            zh_cn: {
                title: 'ÈÖç‰ª∂Êõ¥Êç¢ÈÄöÁü•',
                content: contentArr
            }
        };

        fetch('https://test.jsjs.net', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ feishuPost }),
            })
            .then(async res => {
                if (!res.ok) {
                    const errText = await res.text();
                    throw new Error(errText || 'ÁΩëÁªúÈîôËØØ');
                }
                return res.json();
            })
            .then(data => {
                showToast('Â∑≤ÂèëÈÄÅÂà∞È£û‰π¶ ‚úÖ', 'success');
                console.log(data);
            })
            .catch(err => {
                showToast('ÂèëÈÄÅÂ§±Ë¥• ‚ùå', 'danger');
                console.error(err);
            });
    }


    // ÂàùÂßãÂåñ
    updateBrandOptions(typeSelect.value);
    update();

    // Âú®ËÑöÊú¨ÈÉ®ÂàÜÊ∑ªÂä†Â¶Ç‰∏ã‰∫ã‰ª∂ÁªëÂÆö
    orderNo.addEventListener('input', function() {
        this.value = this.value.replace(/\D/g, '');
    });
    orderNo.addEventListener('paste', function(e) {
        // Âª∂ËøüÂ§ÑÁêÜÔºåÁ°Æ‰øùÁ≤òË¥¥ÂÜÖÂÆπÂ∑≤ËøõÂÖ•input
        setTimeout(() => {
            const val = this.value.match(/(\d+)(?!.*\d)/);
            this.value = val ? val[0] : '';
        }, 0);
    });
    </script>
</body>

</html>
